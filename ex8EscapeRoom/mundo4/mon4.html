<!DOCTYPE html>
<html>
<head>
  <title>Mon4 - Metal Gear Laberinto</title>
  <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
  <script src="https://castelletm12b.cat/build/assets/question.js" defer></script>
  <script>
    AFRAME.registerComponent("trigger-alarm", {
      init: function () {
        this.el.addEventListener("mouseenter", () => {
          alert("ðŸš¨ Alarma! Has estat detectat! Torna a comenÃ§ar des del punt inicial.");
          document.querySelector("#rig").setAttribute("position", "0 0 0");
        });
      }
    });

    AFRAME.registerComponent("show-hint", {
      init: function () {
        this.el.addEventListener("click", () => {
          alert("ðŸ“¡ Pista: La targeta d'accÃ©s es troba darrere d'una caixa al costat d'una cÃ mera de seguretat.");
        });
      }
    });
  </script>
  <script>
    AFRAME.registerComponent("reveal-console", {
        init: function () {
            this.el.addEventListener("click", () => {
                // Mostrar la consola de salida
                alert("ðŸ’» Has trobat la targeta d'accÃ©s! La consola estÃ  disponible.");
                document.querySelector("#console").setAttribute("visible", "true");
            });
        }
    });
  </script>
</head>
<body>
  <a-scene>
    <a-assets>
      <audio id="metalGearMusic" src="assets/Intruder 3.mp3" preload="auto"></audio>
      <a-sound src="#metalGearMusic" autoplay="true" loop="true" position="0 2 0"></a-sound>

      <img id="wallTexture" src="assets/metal_wall.png">
      <img id="floorTexture" src="assets/metal_floor.jpg">
      <img id="ceilingTexture" src="assets/metal_ceiling.jpg">
      <img id="cardTexture" src="assets/Card.jpeg">
      <a-asset-item id="cameraModel" src="assets/camera/scene.gltf"></a-asset-item>
      <a-asset-item id="consoleModel" src="assets/console/scene.gltf"></a-asset-item>
    </a-assets>

    <a-light type="ambient" color="#888"></a-light>
    <a-light type="directional" intensity="0.6" position="1 3 2"></a-light>

    <a-plane src="#floorTexture" rotation="-90 0 0" width="60" height="60" repeat="10 10"></a-plane>
    <a-plane src="#ceilingTexture" rotation="90 0 0" position="0 5 0" width="60" height="60"></a-plane>

    <!-- Laberinto exterior cerrado -->
    <a-box position="0 2.5 -30" width="60" height="5" depth="0.1" src="#wallTexture"></a-box>
    <a-box position="0 2.5 30" width="60" height="5" depth="0.1" src="#wallTexture"></a-box>
    <a-box position="-30 2.5 0" width="0.1" height="5" depth="60" src="#wallTexture"></a-box>
    <a-box position="30 2.5 0" width="0.1" height="5" depth="60" src="#wallTexture"></a-box>

    <!-- Paredes internas del laberinto (ejemplo simple, puedes aÃ±adir mÃ¡s) -->
    <a-box position="-15 2.5 -15" width="30" height="5" depth="0.1" src="#wallTexture"></a-box>
    <a-box position="15 2.5 -10" width="30" height="5" depth="0.1" src="#wallTexture"></a-box>
    <a-box position="0 2.5 0" width="0.1" height="5" depth="60" src="#wallTexture"></a-box>
    <a-box position="-10 2.5 10" width="20" height="5" depth="0.1" src="#wallTexture"></a-box>
    <a-box position="10 2.5 15" width="20" height="5" depth="0.1" src="#wallTexture"></a-box>
    <a-box position="-20 2.5 20" width="0.1" height="5" depth="20" src="#wallTexture"></a-box>
    <a-box position="20 2.5 -20" width="0.1" height="5" depth="20" src="#wallTexture"></a-box>

    <!-- CÃ¡maras en las paredes -->
    <a-entity gltf-model="#cameraModel" position="-14 3 -15" scale="0.5 0.5 0.5" rotation="0 90 0" show-hint></a-entity>
    <a-entity gltf-model="#cameraModel" position="14 3 -10" scale="0.5 0.5 0.5" rotation="0 -90 0" show-hint></a-entity>
    <a-entity gltf-model="#cameraModel" position="0 3 0" scale="0.5 0.5 0.5" rotation="0 180 0" show-hint></a-entity>
    <a-entity gltf-model="#cameraModel" position="-10 3 10" scale="0.5 0.5 0.5" rotation="0 0 0" show-hint></a-entity>
    <a-entity gltf-model="#cameraModel" position="10 3 15" scale="0.5 0.5 0.5" rotation="0 180 0" show-hint></a-entity>

    <!-- Cajas para esconderse -->
    <a-box position="-14 0.5 -16" width="1" height="1" depth="1" color="#555"></a-box>
    <a-box position="13 0.5 -9" width="1" height="1" depth="1" color="#666"></a-box>
    <a-box position="0 0.5 1" width="1" height="1" depth="1" color="#777"></a-box>
    <a-box position="-9 0.5 9" width="1" height="1" depth="1" color="#444"></a-box>
    <a-box position="9 0.5 14" width="1" height="1" depth="1" color="#333"></a-box>

    <!-- Targeta d'accÃ©s amagada darrere d'una caixa -->
    <a-box id="keyCard" position="-14 0.6 -16" width="0.3" height="0.2" depth="0.05" src="#cardTexture" reveal-console></a-box>

    <!-- ðŸ’» Ordenador oculto (salida) -->
    <a-entity id="console" gltf-model="#consoleModel" position="0 0 18" scale="0.5 0.5 0.5" visible="false"></a-entity>

    <!-- Porta de sortida -->
    <a-box question="81" id="exitDoor" position="0 1 29.9" width="1" height="2" depth="0.1"
           material="opacity: 0; transparent: true" onclick="checkQuestion()"></a-box>

    <!-- CÃ mera i moviment 3D -->
    <a-entity id="rig" movement-controls position="0 0 0">
      <a-entity camera look-controls wasd-controls position="0 1.6 0"></a-entity>
    </a-entity>
  </a-scene>

</body>
</html>
