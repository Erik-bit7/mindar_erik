<!DOCTYPE html>
<html>
<head>
  <title>Mon4 - Metal Gear</title>
  <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
  <script>
    AFRAME.registerComponent("trigger-alarm", {
      init: function () {
        this.el.addEventListener("mouseenter", () => {
          alert("🚨 Alarma! Has estat detectat! Torna a començar des del punt inicial.");
          document.querySelector("#rig").setAttribute("position", "0 0 0");
        });
      }
    });

    AFRAME.registerComponent("show-hint", {
      init: function () {
        this.el.addEventListener("click", () => {
          alert("📡 Pista: La targeta d'accés es troba darrere d'una caixa al costat d'una càmera de seguretat.");
        });
      }
    });
  </script>
</head>
<body>
  <a-scene>
    <a-assets>
      <!-- Música d'ambient -->
      <audio id="metalGearMusic" src="assets/Intruder 3.mp3" preload="auto"></audio>
      <a-sound src="#metalGearMusic" autoplay="true" loop="true" position="0 2 0"></a-sound>

      <!-- Textures -->
      <img id="wallTexture" src="assets/metal_wall.png">
      <img id="floorTexture" src="assets/metal_floor.jpg">
      <!-- Añadir la imagen de la tarjeta -->
      <img id="cardTexture" src="assets/Card.jpeg">
      <!-- Añadir el modelo 3D de la cámara -->
      <a-asset-item id="cameraModel" src="assets/camera/scene.gltf"></a-asset-item>
      <!-- Añadir la imagen del techo -->
      <img id="ceilingTexture" src="assets/metal_ceiling.jpg">
    </a-assets>

    <!-- Techo como cielo -->
    <a-sky src="#ceilingTexture"></a-sky>

    <!-- Sòl -->
    <a-plane src="#floorTexture" rotation="-90 0 0" width="30" height="30" repeat="5 5"></a-plane>

    <!-- Techo -->
    <a-plane src="#ceilingTexture" rotation="-90 0 0" position="0 5 0" width="30" height="30"></a-plane>

    <!-- Techo que cubre todo el laberinto -->
    <a-plane src="#ceilingTexture" rotation="-90 0 0" position="0 10 0" width="50" height="50"></a-plane>

    <!-- Pareds (laberinto) -->
    <a-box position="0 2.5 -5" width="20" height="5" depth="0.1" src="#wallTexture"></a-box>
    <a-box position="10 2.5 0" depth="20" height="5" width="0.1" src="#wallTexture"></a-box>
    <a-box position="-10 2.5 0" depth="20" height="5" width="0.1" src="#wallTexture"></a-box>
    <a-box position="0 2.5 5" width="20" height="5" depth="0.1" src="#wallTexture"></a-box>

    <!-- Paredes internas del laberinto -->
    <a-box position="5 2.5 -2.5" width="10" height="5" depth="0.1" src="#wallTexture"></a-box>
    <a-box position="-5 2.5 2.5" width="10" height="5" depth="0.1" src="#wallTexture"></a-box>
    <a-box position="0 2.5 0" depth="10" height="5" width="0.1" src="#wallTexture"></a-box>
    <a-box position="2.5 2.5 -2.5" depth="5" height="5" width="0.1" src="#wallTexture"></a-box>

    <!-- Zona d'alarma (detector) -->
    <a-box position="2 0.1 -2" width="3" height="0.2" depth="3" color="red" trigger-alarm opacity="0.2"></a-box>

    <!-- Càmera de seguretat (simulada) -->
    <a-entity position="2 2 -2" scale="0.5 0.5 0.5" rotation="0 180 0" 
              gltf-model="#cameraModel" show-hint></a-entity>

    <!-- Targeta d'accés amagada -->
    <a-box id="keyCard" position="1.5 0.5 -3" width="0.3" height="0.2" depth="0.05" 
           src="#cardTexture" show-hint></a-box>

    <!-- Porta invisible amb pregunta -->
    <a-box id="exitDoor" position="0 1 5" width="1" height="2" depth="0.1"
           material="opacity: 0; transparent: true" onclick="checkQuestion()"></a-box>

    <!-- Decoració: caixes metàl·liques -->
    <a-box position="1.5 0.5 -3.5" width="1" height="1" depth="1" color="#333"></a-box>
    <a-box position="-2 0.5 -1" width="1" height="1" depth="1" color="#444"></a-box>

    <!-- Càmera i moviment 3D -->
    <a-entity id="rig" movement-controls position="0 0 0">
      <a-entity camera look-controls wasd-controls position="0 1.6 0"></a-entity>
    </a-entity>
  </a-scene>

  <script>
    function checkQuestion() {
      let resposta = prompt("¿Cómo se llama el protagonista de Metal Gear Solid? (Nombre y apellido, primera letra mayúscula)");
      if (resposta === "Solid Snake") {
        alert("Correcto! Has completado la missió!");
        window.location.href = "final.html";
      } else {
        alert("Incorrecto. Intenta de nuevo.");
      }
    }
  </script>
</body>
</html>