<!DOCTYPE html>
<html>
<head>
  <title>Mon1</title>
  <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
  <script src="https://castelletm12b.cat/build/assets/question.js" defer></script>
  <script>
    AFRAME.registerComponent("show-hint", {
      init: function () {
        this.el.addEventListener("click", () => {
          alert("Pista: Busca la puerta invisible entre una tubería casi al nivel del suelo y una estrella que está en el suelo");
        });
      }
    });
  </script>
</head>
<body>
  <a-scene cursor="rayOrigin: mouse">
    <!-- Cámara principal con cursor -->
    <a-entity camera look-controls wasd-controls position="0 1.6 0">
      <a-entity cursor="rayOrigin: mouse" raycaster="objects: .clickable" position="0 0 -1"
                geometry="primitive: ring; radiusInner: 0.01; radiusOuter: 0.02"
                material="color: red; shader: flat">
      </a-entity>
    </a-entity>

    <a-assets>
      <!-- Modelos -->
      <a-asset-item id="bloqueOriginal" src="assets/Bloque/scene.gltf"></a-asset-item>
      <a-asset-item id="bloqueClon" src="assets/block/scene.gltf"></a-asset-item>
      <img id="sky" src="assets/Mario-world.jpeg">
      <img id="returnImg" src="assets/Return.jpg">
    </a-assets>

    <!-- Música de fondo -->
    <a-entity sound="src: url(assets/overworld-theme.mp3); autoplay: true; loop: true"></a-entity>

    <!-- Fondo del mundo -->
    <a-sky src="#sky"></a-sky>

    <!-- Bloques distribuidos por los límites del mapa -->
    <a-entity gltf-model="#bloqueClon" position="-20 5 -20" scale="0.01 0.01 0.01"></a-entity>
    <a-entity gltf-model="#bloqueClon" position="20 5 -20" scale="0.01 0.01 0.01"></a-entity>
    <a-entity gltf-model="#bloqueClon" position="-20 5 20" scale="0.01 0.01 0.01"></a-entity>
    <a-entity gltf-model="#bloqueClon" position="0 5 -25" scale="0.01 0.01 0.01"></a-entity>
    <a-entity gltf-model="#bloqueClon" position="0 5 25" scale="0.01 0.01 0.01"></a-entity>
    <a-entity gltf-model="#bloqueClon" position="-25 5 0" scale="0.01 0.01 0.01"></a-entity>
    <a-entity gltf-model="#bloqueClon" position="25 5 0" scale="0.01 0.01 0.01"></a-entity>

    <!-- Bloque con pista -->
    <a-entity gltf-model="#bloqueOriginal" position="20 2 20" scale="0.01 0.01 0.01" show-hint></a-entity>

    <!-- Puerta invisible -->
    <a-box question="63" id="exitDoor" position="-2 0.5 -3" width="1" height="1" depth="1"
           material="opacity: 0; transparent: true"></a-box>

    <!-- Botón de regreso -->
    <a-plane class="clickable" id="backToHome" position="0 5 -30" rotation="0 180 0"
             width="5" height="5" src="#returnImg" material="transparent: true">
    </a-plane>
  </a-scene>

  <script>
    // Redirección al menú principal
    function goToHome() {
      window.location.href = "../RetroEscapeRoom.html";
    }

    // Añadir evento de clic al plano
    document.addEventListener("DOMContentLoaded", () => {
      const returnButton = document.querySelector("#backToHome");
      if (returnButton) {
        returnButton.addEventListener("click", goToHome);
      }
    });

    // Temporizador
    let timer = 60;
    const timerDisplay = document.createElement("div");
    timerDisplay.style.position = "absolute";
    timerDisplay.style.top = "10px";
    timerDisplay.style.left = "10px";
    timerDisplay.style.color = "white";
    timerDisplay.style.fontSize = "24px";
    timerDisplay.style.fontFamily = "Arial, sans-serif";
    timerDisplay.style.backgroundColor = "rgba(0, 0, 0, 0.5)";
    timerDisplay.style.padding = "10px";
    timerDisplay.style.borderRadius = "8px";
    timerDisplay.innerHTML = `Tiempo restante: ${timer}s`;
    document.body.appendChild(timerDisplay);

    const countdown = setInterval(() => {
      timer--;
      timerDisplay.innerHTML = `Tiempo restante: ${timer}s`;
      if (timer <= 0) {
        clearInterval(countdown);
        alert("¡Se acabó el tiempo! Inténtalo de nuevo.");
        window.location.reload();
      }
    }, 1000);
  </script>
</body>
</html>